services:
    backend:
        image: php:8-alpine
        working_dir: /var/www
        container_name: backend
        environment:
            docker: "true"
        ports:
            - "8080:8080"
        volumes:
            - .:/var/www
            - logs:/var/www/logs
        depends_on:
            - request_handler
        command: php -S 0.0.0.0:8080 -t api

    rabbitmq:
        container_name: rabbitmq
        image: 'rabbitmq:management'
        restart: unless-stopped
        env_file: .env
        ports:
            - 15672:15672
            - 5672:5672
        volumes:
         - rabbitmq-data:/var/lib/rabbitmq

    request_handler:
        build: .
        working_dir: /var/www
        container_name: request-handler
        volumes:
            - .:/var/www
            - logs:/var/www/logs
        restart: unless-stopped
        tty: true
        depends_on:
            - rabbitmq
        command: make request_hanlder-start

    swagger:
        image: swaggerapi/swagger-ui
        container_name: swagger
        ports:
            - 8081:8080
        environment:
            BASE_URL: /swagger
            SWAGGER_JSON: /schemas/swagger.yaml
        volumes:
            - ./swagger:/schemas

volumes:
    logs:
        driver: local
    rabbitmq-data:
  