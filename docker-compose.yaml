version: '3.9'

services:
  nginx:
    image: nginx:alpine
    container_name: hw1-nginx
    hostname: nginx
    ports:
      - "3751:80"
    volumes:
      - ./nginx/default.conf:/etc/nginx/conf.d/default.conf
      - socket:/unix-socket
    depends_on:
      - php
    networks:
      - hw1

  redis:
    image: redis:latest
    container_name: hw1-redis
    command: redis-server --requirepass ${REDIS_PASSWORD}

  memcached:
    image: memcached
    container_name: hw1-memcached
    command:
      - --conn-limit=1024
      - --memory-limit=64
      - --threads=4
    networks:
      - hw1

  php:
    build:
      context: php-fpm
    container_name: hw1-php-fpm
    volumes:
      - ./app:/var/www
      - ./php-fpm/www.conf:/usr/local/etc/php-fpm.d/zz-docker.conf
      - socket:/unix-socket
    networks:
      - hw1

  postgres:
    image: postgres:latest
    container_name: hw1-postgres
    environment:
      POSTGRES_USER: ${DB_USER_NAME}
      POSTGRES_PASSWORD: ${DB_USER_PASSWORD}
      POSTGRES_DB: ${DB_DB_NAME}
    volumes:
      - postgres:/var/lib/postgresql/data
    networks:
      - hw1

volumes:
  socket:
    driver: local
  postgres:
    driver: local

networks:
  hw1: