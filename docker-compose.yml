version: '3.8'

networks:
  app_network:
    name: ${APP_NAME}_network

services:
  elasticsearch:
    image: elasticsearch:8.13.0
    container_name: ${APP_NAME}_elasticsearch
    ports:
      - "${ES_PORT}:9200"
    volumes:
      - ./docker/elasticsearch/data:/usr/share/elasticsearch/data
    environment:
      - ELASTIC_PASSWORD=${ES_PASSWORD}
      - node.name=es8
      - cluster.name=es-docker-cluster
      - discovery.type=single-node
      - xpack.security.enabled=false
    networks:
      - app_network

  php:
    build:
      context: .
      dockerfile: ./docker/php/Dockerfile
    tty: true
    container_name: ${APP_NAME}_php
    env_file: .env
    volumes:
      - .:/var/www/app
    networks:
      - app_network

  composer:
    image: composer:latest
    container_name: ${APP_NAME}_composer
    working_dir: /var/www/app
    command: [ "composer", "install" ]
    volumes:
      - .:/var/www/app