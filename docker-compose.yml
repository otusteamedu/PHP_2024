version: '3'

services:
  php-fpm:
    build:
      context: docker/php
      dockerfile: Dockerfile
    volumes:
      - ./:/data
    networks:
      - redis-network
    working_dir: /data
  db:
    image: redis:latest
    container_name: redis
    command:
      - 'redis-server'
      - '--requirepass ${REDIS_PASSWORD}'
      - '--maxmemory ${REDIS_MAXMEMORY:-50mb}'
      - '--maxmemory-policy ${REDIS_POLICY:-noeviction}'
      - '--save 900 1'
      - '--save 300 10'
      - '--save 60 10000'
    healthcheck:
      test: [ "CMD", "redis-cli", "ping" ]
      retries: 3
      timeout: 5s
    volumes:
      - ./redis_db:/data
    environment:
      - REDIS_DATABASE=${REDIS_DATABASE}
    networks:
      - redis-network
networks:
  redis-network:
    driver: bridge
