# Click the Variables button, above, to create your own variables.
GET ${exampleVariable1} // _search
{
  "query": {
    "${exampleVariable2}": {} // match_all
  }
}

# Поиск
GET /otus-shop/_search

# Фильтр по категории
GET /otus-shop/_search
{
  "query": {
    "bool": {
      "must": [
        {
          "term": {
            "category": "Исторический роман"
          }
        }
      ]
    }
  }
}

# Фильтр по наличию в магазина
GET /otus-shop/_search
{
  "query": {
    "nested": {
      "path": "stock", 
      "query": {
        "bool": {
          "must": [
            {
              "match": {
                "stock.shop": "Ленина"
              }
            }
            ,
            {
              "range": {
                "stock.stock": {
                  "gte": 0,
                  "lte": 1
                }
              }
            }
          ]
        }
      }
    }
  }
}

# Фильтр с ошибками
GET /otus-shop/_search
{
  "query": {
    "match": {
      "title": {
        "query": "Рыцори Тирминатара",
        "operator": "and",
        "fuzziness": "2"
      }
    }
  }
}

# Фильтр по цене
GET /otus-shop/_search
{
  "query": {
    "range": {
      "price": { "gte": 1200, "lt": 1202 }
    }
  }
}

# Create index
PUT /otus-test

# Create mappping
PUT /otus-shop/_mapping
{
    "properties": {
        "title": {
            "type": "text"
        },
        "sku": {
            "type": "text"
        },
        "category": {
            "type": "text"
        },
        "price": {
            "type": "scaled_float",
            "scaling_factor": 100
        },
        "stock": {
            "type": "nested",
            "properties": {
                "shop": { "type": "text" },
                "stock": { "type": "long"}
            }
        }
    }
}

POST /_bulk
{"create":{"_index":"otus-shop","_id":"507-500"}}
{"title":"Советы по выращиванию Терминатора в домашних условиях","sku":"507-500","category":"Детектив","price":3022,"stock":[{"shop":"Мира","stock":12},{"shop":"Ленина","stock":12}]}

#=====================Test=============================
# Search
GET /otus-test/_search

GET /otus-test/_search
{
  "query": {
    "nested": {
      "path": "stock", 
      "query": {
        "bool": {
          "must": [
            {
              "terms": {
                "stock.shop": ["Ленина", "Мира1"]
              }
            }
            ,
            {
              "range": {
                "stock.stock": {
                  "gte": 0,
                  "lte": 1
                }
              }
            }
          ]
        }
      }
    }
  }
}

# Фильтр по категории
GET /otus-test/_search
{
  "query": {
    "bool": {
      "must": [
        {
          "term": {
            "category": "Исторический роман"
          }
        }
      ]
    }
  }
}

# Create index
PUT /otus-test

PUT /otus-test/_mapping
{
    "properties": {
        "title": {
            "type": "text"
        },
        "sku": {
            "type": "text"
        },
        "category": {
            "type": "keyword"
        },
        "price": {
            "type": "scaled_float",
            "scaling_factor": 100
        },
        "stock": {
            "type": "nested",
            "properties": {
                "shop": { "type": "keyword" },
                "stock": { "type": "short"}
            }
        }
    }
}
# Bulk load
POST /_bulk
{"create":{"_index":"otus-test","_id":"500-000"}}
{"title":"Кто подставил поручика Ржевского на Луне","sku":"500-000","category":"Исторический роман","price":3761,"stock":[{"shop":"Мира","stock":17},{"shop":"Ленина","stock":1}]}
